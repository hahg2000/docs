<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>四、Spring与DAO | hahg的简易博客</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/docs/assets/img/favicon.ico">
    <link rel="manifest" href="/docs/manifest.json">
    <link rel="apple-touch-icon" href="/docs/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/docs/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="hahg的简易博客">
    <meta name="author" content="vuepress搭建的hahg简易博客">
    <meta name="keywords" content="hahg">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/docs/assets/css/0.styles.a4afb5bf.css" as="style"><link rel="preload" href="/docs/assets/js/app.4e37dad2.js" as="script"><link rel="preload" href="/docs/assets/js/3.055be0a8.js" as="script"><link rel="preload" href="/docs/assets/js/2.d32c4d1a.js" as="script"><link rel="preload" href="/docs/assets/js/28.70255cc2.js" as="script"><link rel="preload" href="/docs/assets/js/4.a96d5034.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.2fb46730.js"><link rel="prefetch" href="/docs/assets/js/11.975c71ee.js"><link rel="prefetch" href="/docs/assets/js/12.059ae769.js"><link rel="prefetch" href="/docs/assets/js/13.649c1695.js"><link rel="prefetch" href="/docs/assets/js/14.6a8737fd.js"><link rel="prefetch" href="/docs/assets/js/15.0b8de0f8.js"><link rel="prefetch" href="/docs/assets/js/16.4410d102.js"><link rel="prefetch" href="/docs/assets/js/17.21542b2a.js"><link rel="prefetch" href="/docs/assets/js/18.9c6b6334.js"><link rel="prefetch" href="/docs/assets/js/19.3805f0fd.js"><link rel="prefetch" href="/docs/assets/js/20.e676d273.js"><link rel="prefetch" href="/docs/assets/js/21.fbdf7495.js"><link rel="prefetch" href="/docs/assets/js/22.9570e257.js"><link rel="prefetch" href="/docs/assets/js/23.4be7db77.js"><link rel="prefetch" href="/docs/assets/js/24.e5dd610a.js"><link rel="prefetch" href="/docs/assets/js/25.b87936e6.js"><link rel="prefetch" href="/docs/assets/js/26.9478d521.js"><link rel="prefetch" href="/docs/assets/js/27.8fb3b881.js"><link rel="prefetch" href="/docs/assets/js/29.882947a3.js"><link rel="prefetch" href="/docs/assets/js/30.7ae5904c.js"><link rel="prefetch" href="/docs/assets/js/31.4b49afd0.js"><link rel="prefetch" href="/docs/assets/js/32.df541b37.js"><link rel="prefetch" href="/docs/assets/js/33.ddaed3de.js"><link rel="prefetch" href="/docs/assets/js/34.5e80203b.js"><link rel="prefetch" href="/docs/assets/js/35.0be63530.js"><link rel="prefetch" href="/docs/assets/js/36.8273634e.js"><link rel="prefetch" href="/docs/assets/js/37.37c9b278.js"><link rel="prefetch" href="/docs/assets/js/38.a9fcef0a.js"><link rel="prefetch" href="/docs/assets/js/5.79d58c64.js"><link rel="prefetch" href="/docs/assets/js/6.dc517ec6.js"><link rel="prefetch" href="/docs/assets/js/7.4ea12e98.js"><link rel="prefetch" href="/docs/assets/js/8.9bc20865.js"><link rel="prefetch" href="/docs/assets/js/9.366e5dea.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.a4afb5bf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="/docs/assets/img/logo.png" alt="hahg的简易博客" class="logo"> <span class="site-name can-hide">hahg的简易博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/docs/tags/" class="nav-link">
  标签分类
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实践学习" class="dropdown-title"><span class="title">实践学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="实践学习" class="mobile-dropdown-title"><span class="title">实践学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          SSM框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs/doStudy/SSM框架/SSM前言/一、SSM框架前言-系统架构.html" class="nav-link">
  SSM前言
</a></li><li class="dropdown-subitem"><a href="/docs/doStudy/SSM框架/MyBatis3/一、MyBatis入门.html" class="nav-link">
  MyBatis3
</a></li><li class="dropdown-subitem"><a href="/docs/doStudy/SSM框架/Spring4/一、Spring概述.html" class="nav-link">
  Spring4
</a></li><li class="dropdown-subitem"><a href="/docs/doStudy/SSM框架/SpringMVC/一、SpringMVC概述.html" class="nav-link">
  SpringMVC
</a></li></ul></li><li class="dropdown-item"><h4>
          前端JS
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs/doStudy/前端JS/原生JS.html" class="nav-link">
  原生JS
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习工具" class="dropdown-title"><span class="title">学习工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习工具" class="mobile-dropdown-title"><span class="title">学习工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/toolDoc/Markdown/Markdown常用指令.html" class="nav-link">
  Markdown笔记
</a></li><li class="dropdown-item"><!----> <a href="/docs/toolDoc/Vim/Vim.html" class="nav-link">
  Vim笔记
</a></li></ul></div></div><div class="nav-item"><a href="/docs/about/about.html" class="nav-link">
  关于我
</a></div><div class="nav-item"><a href="https://www.vuepress.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/docs/tags/" class="nav-link">
  标签分类
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实践学习" class="dropdown-title"><span class="title">实践学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="实践学习" class="mobile-dropdown-title"><span class="title">实践学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          SSM框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs/doStudy/SSM框架/SSM前言/一、SSM框架前言-系统架构.html" class="nav-link">
  SSM前言
</a></li><li class="dropdown-subitem"><a href="/docs/doStudy/SSM框架/MyBatis3/一、MyBatis入门.html" class="nav-link">
  MyBatis3
</a></li><li class="dropdown-subitem"><a href="/docs/doStudy/SSM框架/Spring4/一、Spring概述.html" class="nav-link">
  Spring4
</a></li><li class="dropdown-subitem"><a href="/docs/doStudy/SSM框架/SpringMVC/一、SpringMVC概述.html" class="nav-link">
  SpringMVC
</a></li></ul></li><li class="dropdown-item"><h4>
          前端JS
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs/doStudy/前端JS/原生JS.html" class="nav-link">
  原生JS
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习工具" class="dropdown-title"><span class="title">学习工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习工具" class="mobile-dropdown-title"><span class="title">学习工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/toolDoc/Markdown/Markdown常用指令.html" class="nav-link">
  Markdown笔记
</a></li><li class="dropdown-item"><!----> <a href="/docs/toolDoc/Vim/Vim.html" class="nav-link">
  Vim笔记
</a></li></ul></div></div><div class="nav-item"><a href="/docs/about/about.html" class="nav-link">
  关于我
</a></div><div class="nav-item"><a href="https://www.vuepress.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Spring4</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/doStudy/SSM框架/Spring4/一、Spring概述.html" class="sidebar-link">一、Spring概述</a></li><li><a href="/docs/doStudy/SSM框架/Spring4/三、Spring与AOP.html" class="sidebar-link">三、Spring与AOP</a></li><li><a href="/docs/doStudy/SSM框架/Spring4/二、Spring与IoC.html" class="sidebar-link">二、Spring与IoC</a></li><li><a href="/docs/doStudy/SSM框架/Spring4/五、Spring与MyBatis.html" class="sidebar-link">五、Spring与MyBatis</a></li><li><a href="/docs/doStudy/SSM框架/Spring4/六、Spring与Web.html" class="sidebar-link">六、Spring与Web</a></li><li><a href="/docs/doStudy/SSM框架/Spring4/四、Spring与DAO.html" class="active sidebar-link">四、Spring与DAO</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/doStudy/SSM框架/Spring4/四、Spring与DAO.html#_4-1-spring-与-jdbc-模板" class="sidebar-link">4.1 Spring 与 JDBC 模板</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/doStudy/SSM框架/Spring4/四、Spring与DAO.html#_4-1-1-导入-jar-包" class="sidebar-link">4.1.1 导入 Jar 包</a></li><li class="sidebar-sub-header"><a href="/docs/doStudy/SSM框架/Spring4/四、Spring与DAO.html#_4-1-2-定义实体类和表" class="sidebar-link">4.1.2 定义实体类和表</a></li><li class="sidebar-sub-header"><a href="/docs/doStudy/SSM框架/Spring4/四、Spring与DAO.html#_4-1-3-定义-service" class="sidebar-link">4.1.3 定义 Service</a></li><li class="sidebar-sub-header"><a href="/docs/doStudy/SSM框架/Spring4/四、Spring与DAO.html#_4-1-4-定义-dao-增删改的完成" class="sidebar-link">4.1.4 定义 Dao——增删改的完成</a></li><li class="sidebar-sub-header"><a href="/docs/doStudy/SSM框架/Spring4/四、Spring与DAO.html#_4-1-5-定义测试类" class="sidebar-link">4.1.5 定义测试类</a></li><li class="sidebar-sub-header"><a href="/docs/doStudy/SSM框架/Spring4/四、Spring与DAO.html#_4-1-6-定义-xml-文件" class="sidebar-link">4.1.6 定义 Xml 文件</a></li><li class="sidebar-sub-header"><a href="/docs/doStudy/SSM框架/Spring4/四、Spring与DAO.html#_4-1-7-数据源的配置" class="sidebar-link">4.1.7 数据源的配置</a></li><li class="sidebar-sub-header"><a href="/docs/doStudy/SSM框架/Spring4/四、Spring与DAO.html#_4-1-8-修改模板的配置" class="sidebar-link">4.1.8 修改模板的配置</a></li><li class="sidebar-sub-header"><a href="/docs/doStudy/SSM框架/Spring4/四、Spring与DAO.html#_4-1-9-查询姓名" class="sidebar-link">4.1.9 查询姓名</a></li><li class="sidebar-sub-header"><a href="/docs/doStudy/SSM框架/Spring4/四、Spring与DAO.html#_4-1-10-查询自定义类型" class="sidebar-link">4.1.10 查询自定义类型</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/doStudy/SSM框架/Spring4/四、Spring与DAO.html#_4-2-spring-的事务管理" class="sidebar-link">4.2 Spring 的事务管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/doStudy/SSM框架/Spring4/四、Spring与DAO.html#_4-2-1-spring-事务管理-api" class="sidebar-link">4.2.1 Spring 事务管理 API</a></li><li class="sidebar-sub-header"><a href="/docs/doStudy/SSM框架/Spring4/四、Spring与DAO.html#_4-2-2-程序举例环境搭建" class="sidebar-link">4.2.2 程序举例环境搭建</a></li><li class="sidebar-sub-header"><a href="/docs/doStudy/SSM框架/Spring4/四、Spring与DAO.html#_4-2-3-使用-spring-的事务代理工厂管理事务" class="sidebar-link">4.2.3 使用 Spring 的事务代理工厂管理事务</a></li><li class="sidebar-sub-header"><a href="/docs/doStudy/SSM框架/Spring4/四、Spring与DAO.html#_4-2-4-事务注解管理事务" class="sidebar-link">4.2.4 事务注解管理事务</a></li><li class="sidebar-sub-header"><a href="/docs/doStudy/SSM框架/Spring4/四、Spring与DAO.html#_4-2-5-使用-aspectj-的-aop-配置管理事务-重点" class="sidebar-link">4.2.5 使用 AspectJ 的 AOP 配置管理事务（重点）</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <!----> <div class="theme-default-content content__default"><h1 id="四、spring与dao"><a href="#四、spring与dao" class="header-anchor">#</a> 四、Spring与DAO</h1> <p>本章内容主要包含两部分：</p> <ol><li>Spring 所使用的 <strong>操作数据库</strong> 的技术之一，<strong>JDBC 模板的使用</strong>；</li> <li>另一部分则为 Spring 对于<strong>事务的管理</strong>。</li></ol> <p>Spring 与 Dao 部分，是 Spring 的两大核心技术 IoC 与 AOP 的典型应用体现：</p> <ul><li>对于 JDBC 模板的使用，是 <strong>IoC 的应用</strong>，是将 JDBC 模板对象注入给了 Dao 层的实现类。</li> <li>对于 Spring 的事务管理，是 <strong>AOP 的应用</strong>，将事务作为切面织入到了 Service 层的业务方 法中。</li></ul> <h2 id="_4-1-spring-与-jdbc-模板"><a href="#_4-1-spring-与-jdbc-模板" class="header-anchor">#</a> 4.1 Spring 与 JDBC 模板</h2> <p>为了避免直接使用 JDBC 而带来的复杂且冗长的代码，Spring 提供了一个强有力的模板类—— JdbcTemplate 来简化 JDBC 操作。</p> <p>并且，数据源 DataSource 对象与模板 JdbcTemplate 对象均 <u>可通过 Bean 的形式定义在配置文件</u> 中，充分发挥了依赖注入的威力。</p> <p>举例： 项目 dao_jdbcTemplate</p> <h3 id="_4-1-1-导入-jar-包"><a href="#_4-1-1-导入-jar-包" class="header-anchor">#</a> 4.1.1 导入 Jar 包</h3> <p>除了 Spring 的基本 Jar 包，数据库驱动 Jar 外，还需要导入两个 Jar 包——事务包【spring-tx-4.3.6.RELEASE.jar】和 JDBC 包【spring-jdbc-4.3.6.RELEASE.jar】</p> <h3 id="_4-1-2-定义实体类和表"><a href="#_4-1-2-定义实体类和表" class="header-anchor">#</a> 4.1.2 定义实体类和表</h3> <p><strong>Student.java：</strong> 这次依旧选择定义学生实体类，类里的属性包括学号 id，姓名 name，年龄 age。数据库的表和实体类一致。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
    <span class="token comment">// setter and getter</span>
    <span class="token comment">// toString</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_4-1-3-定义-service"><a href="#_4-1-3-定义-service" class="header-anchor">#</a> 4.1.3 定义 Service</h3> <p>这里的 Service 没有什么需求，直接调用 Dao 层的相对应的方法即可，所以 Service 里的方法名和 Dao 里的差不多。</p> <p><strong>IStudentService.java：</strong> 定义接口</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IStudentService</span> <span class="token punctuation">{</span>
	<span class="token comment">// 增删改</span>
	<span class="token keyword">void</span> <span class="token function">addStudent</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">removeById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">modifyStudent</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 较复杂的查询</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllStudentsNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> <span class="token function">findStudentNameById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 基础的查询</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllStudents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Student</span> <span class="token function">findStudentById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>StudentServiceImpl.java：</strong> Service 类里有 Dao 的 对象，设置 setter 方法用于给 Spring 容器依赖注入。然后全部方法都可以直接调用 Dao 层方法实现。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IStudentService</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">IStudentDao</span> dao<span class="token punctuation">;</span>
	
	<span class="token comment">// dao的setter方法用于依赖注入</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDao</span><span class="token punctuation">(</span><span class="token class-name">IStudentDao</span> dao<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>dao <span class="token operator">=</span> dao<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addStudent</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		dao<span class="token punctuation">.</span><span class="token function">insertStudent</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		dao<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">modifyStudent</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		dao<span class="token punctuation">.</span><span class="token function">updateStudent</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllStudentsNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> studentsNames <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">selectAllStudentsNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> studentsNames<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">findStudentNameById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> studentName <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">selectStudentNameById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> studentName<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllStudents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> dao<span class="token punctuation">.</span><span class="token function">selectAllStudents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Student</span> <span class="token function">findStudentById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> dao<span class="token punctuation">.</span><span class="token function">selectStudentById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><h3 id="_4-1-4-定义-dao-增删改的完成"><a href="#_4-1-4-定义-dao-增删改的完成" class="header-anchor">#</a> 4.1.4 定义 Dao——增删改的完成</h3> <p>**IStudentDao.java：**定义接口，方法名与 Service 里的一致。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IStudentDao</span> <span class="token punctuation">{</span>

	<span class="token keyword">void</span> <span class="token function">insertStudent</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">updateStudent</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAllStudentsNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> <span class="token function">selectStudentNameById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAllStudents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Student</span> <span class="token function">selectStudentById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>StudentDaoImpl.java：这里先实现增删改操作。Dao 的实现类需要操作数据库，所以需要 <strong>使用 JDBC 模板</strong> 来代替我们来操作。</p> <p>使用方法：</p> <ol><li>让实现类继承 JdbcDaoSupport 类</li> <li>使用 this.getJdbcTemplate() 来获取 jdbc 模板对象</li> <li>jdbc 模板对象对于数据库增删改都是使用 update 方法来实现的</li> <li>我们使用的 update 方法是两个参数的，第一参数为 sql 语句；第二个参数为可变长度参数，可以放多个参数以逗号隔开，或者传进一个参数数组。</li> <li>这里的 jdbc 模板是多例的。</li></ol> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>JdbcTemplate 对象是多例的，即系统会为每一个使用模板对象的线程（方法）创建一个 JdbcTemplate 实例，并且在该线程（方法）结束时，<strong>自动释放 JdbcTemplate 实例</strong>。所以在 <u>每次使用 JdbcTemplate 对象时，都需要通过 getJdbcTemplate()方法获取</u>。</p></div> <p><strong>StudentDaoImpl.java</strong>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentDaoImpl</span> <span class="token keyword">extends</span> <span class="token class-name">JdbcDaoSupport</span> <span class="token keyword">implements</span> <span class="token class-name">IStudentDao</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertStudent</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;insert into student(name,age) values (?,?)&quot;</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> student<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> student<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;delete from student where id=?&quot;</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateStudent</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;update student set name=?, age=? where id=?&quot;</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> student<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> student<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> student<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_4-1-5-定义测试类"><a href="#_4-1-5-定义测试类" class="header-anchor">#</a> 4.1.5 定义测试类</h3> <p><strong>MyTest.java：</strong> 在测试类中，将提取 ApplicationContext 对象和 IStudentService 对象。</p> <p>快捷键：对着需要提取的变量按下 Ctrl + 1，然后选中 “ Convert local variable to fileld ”。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTest</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">IStudentService</span> service<span class="token punctuation">;</span>
	
	<span class="token annotation punctuation">@Before</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myBefore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;applicationContext.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		service <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">IStudentService</span><span class="token punctuation">)</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;studentService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		 <span class="token class-name">Student</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		 service<span class="token punctuation">.</span><span class="token function">addStudent</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		service<span class="token punctuation">.</span><span class="token function">removeById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Student</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		student<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		service<span class="token punctuation">.</span><span class="token function">modifyStudent</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="_4-1-6-定义-xml-文件"><a href="#_4-1-6-定义-xml-文件" class="header-anchor">#</a> 4.1.6 定义 Xml 文件</h3> <h4 id="_1-添加约束头"><a href="#_1-添加约束头" class="header-anchor">#</a> （1）添加约束头</h4> <p>约束头需要记不清楚的话，直接使用最全约束即可。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
	<span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span> 
	<span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span>
	<span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/aop<span class="token punctuation">&quot;</span></span> 
	<span class="token attr-name"><span class="token namespace">xmlns:</span>tx</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/tx<span class="token punctuation">&quot;</span></span>
	<span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>
        http://www.springframework.org/schema/beans 
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context 
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/tx 
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop 
        http://www.springframework.org/schema/aop/spring-aop.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_2-添加普通bean"><a href="#_2-添加普通bean" class="header-anchor">#</a> （2）添加普通Bean</h4> <p>首先添加 Service 类：Service 类中的属性 Dao 类需要注入。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>studentService<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.hahg.service.StudentServiceImpl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>studentDao<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>然后添加 Dao 类：在 Dao 的实现类没有明显地表示 jdbc 模板是该类的属性，这时可以查看其父类 JdbcDaoSupport 的属性</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>studentDao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.hahg.dao.StudentDaoImpl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbcTemplate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myJdbcTemplate<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>下面是 JdbcDaoSupport 的源代码，可以看见其拥有 JdbcTemplate 对象和其 setter 方法，所以可以对其进行设值注入。</p> <p><strong>JdbcDaoSupport.class：</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">JdbcDaoSupport</span> <span class="token keyword">extends</span> <span class="token class-name">DaoSupport</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">setJdbcTemplate</span><span class="token punctuation">(</span><span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">;</span>
		<span class="token function">initTemplateConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>又有个问题，那么如何使用数据源来创建 JdbcTemplate 模板呢？这时查看 JdbcTemplate 的源码。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// JdbcTemplate.class</span>
<span class="token comment">// 发现里面没有 DataSource 对象，所以继续查看其父类的源代码</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcTemplate</span> <span class="token keyword">extends</span> <span class="token class-name">JdbcAccessor</span> <span class="token keyword">implements</span> <span class="token class-name">JdbcOperations</span> <span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
    
<span class="token comment">// JdbcAccessor.class</span>
<span class="token comment">// 发现里面有 DataSource 对象，以及其 setter 和 getter 方法</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">JdbcAccessor</span> <span class="token keyword">implements</span> <span class="token class-name">InitializingBean</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>
    
    <span class="token comment">/**
	 * Set the JDBC DataSource to obtain connections from.
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDataSource</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>dataSource <span class="token operator">=</span> dataSource<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * Return the DataSource used by this template.
	 */</span>
	<span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>所以直接使用 &lt;property/&gt; 标签设置 DataSource 属性即可。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myJdbcTemplate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.core.JdbcTemplate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_4-1-7-数据源的配置"><a href="#_4-1-7-数据源的配置" class="header-anchor">#</a> 4.1.7 数据源的配置</h3> <p>使用 JDBC 模板，首先需要配置好数据源，数据源直接以 Bean 的形式配置在 Spring 配 置文件中。根据数据源的不同，其配置方式不同。下面主要讲解三种常用数据源的配置方式：</p> <ol><li>Spring 默认的数据源</li> <li>DBCP 数据源</li> <li>C3P0 数据源</li></ol> <h4 id="_1-spring-默认的数据源"><a href="#_1-spring-默认的数据源" class="header-anchor">#</a> （1）Spring 默认的数据源</h4> <p>Spring 默认的数据源为 DriverManagerDataSource，其需要配置四个属性。</p> <ul><li><p>driverClassName，用于接收 DB 驱动。</p></li> <li><p>url，用于获取连接数据库的参数。</p></li> <li><p>username，用于获取数据库的登录账号。</p></li> <li><p>password ，用于获取数据库的登录密码。</p></li></ul> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 注册数据源：Spring内置连接池	--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myDataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.datasource.DriverManagerDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driverClassName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.driver}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.url}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.user}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.password}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_2-dbcp-数据源"><a href="#_2-dbcp-数据源" class="header-anchor">#</a> （2）DBCP 数据源</h4> <p>BasicDataSource DBCP，DataBase Connection Pool，是 apache 下的项目，使用该数据源，需要导入两个 Jar 包。</p> <ul><li>【com.springsource.org.apache.commons.dbcp-1.2.2.osgi.jar】</li> <li>【com.springsource.org.apache.commons.pool-1.5.3.jar】</li></ul> <p>DBCP 数据源为 BasicDataSource，其需要配置四个属性。属性名和上面一致。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 注册数据源：DBCP	--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myDataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.commons.dbcp.BasicDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driverClassName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.driver}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.url}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.user}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.password}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_3-c3p0-数据源"><a href="#_3-c3p0-数据源" class="header-anchor">#</a> （3）C3P0 数据源</h4> <p>使用 C3P0 数据源，需要导入一个 Jar 包，在 Spring 依赖库的解压目录的 com.mchange.c3p0 目录。【com.springsource.com.mchange.v2.c3p0-0.9.1.2.jar】</p> <p>C3P0 的数据源为 ComboPooledDataSource，其需要配置四个属性。</p> <ul><li><p>driverClass，用于接收 DB 驱动。</p></li> <li><p>jdbcUrl，用于获取连接数据库的参数。</p></li> <li><p>user，用于获取数据库的登录账号。</p></li> <li><p>password，用于获取数据库的登录密码。</p></li></ul> <p>C3P0 数据库也可以配置其他的辅助属性，例如 <u>最大空闲时间，连接池中保留的最大连接数</u> 等。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 注册数据源：C3P0 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myDataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.mchange.v2.c3p0.ComboPooledDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driverClass<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.driver}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbcUrl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.url}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.user}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.password}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_4-使用属性文件配置四要素"><a href="#_4-使用属性文件配置四要素" class="header-anchor">#</a> （4）使用属性文件配置四要素</h4> <p>在 Xml 文件中使用下述标签来引用属性文件。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>classpath:jdbc.properties<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>属性文件需要注意两点：</p> <ol><li>如果驱动为较高版本，则驱动的包名为【com.mysql.<span style="color:red;">cj</span>.jdbc.Driver】；若为低版本，则为【com.mysql.jdbc.Driver】，少了一层 cj 包。</li> <li>如果数据库为较高版本，则需要加上时间戳，还可以根据需求继续加上编码格式。</li></ol> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">jdbc.driver</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.cj.jdbc.Driver</span>
<span class="token attr-name">jdbc.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql:///spring?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC</span>
<span class="token attr-name">jdbc.user</span><span class="token punctuation">=</span><span class="token attr-value">root</span>
<span class="token attr-name">jdbc.password</span><span class="token punctuation">=</span><span class="token attr-value">password</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_4-1-8-修改模板的配置"><a href="#_4-1-8-修改模板的配置" class="header-anchor">#</a> 4.1.8 修改模板的配置</h3> <p>上面为 Dao 层注册模板新注册了两个 Bean ：</p> <ul><li>使用 DataSource 注册 JdbcTemplate</li> <li>再使用 JdbcTemplate 注册 Dao 层</li></ul> <p>再查看 JdbcDaoSupport 类的源码，发现其有个 setDataSource 的方法。</p> <p>其方法需要传递 <strong>数据源</strong> 作为参数，在方法里判断如果 <strong>没有创建 JdbcTemplate 对象</strong>，就会根据数据源创建。</p> <p>所以可以不需要 jdbcTemplate 这个 Bean 了，直接把 DataSource 传给 Dao 即可。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">JdbcDaoSupport</span> <span class="token keyword">extends</span> <span class="token class-name">DaoSupport</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>	
	
    <span class="token comment">/**
	 * Set the JDBC DataSource to be used by this DAO.
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">setDataSource</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> dataSource <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate<span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate <span class="token operator">=</span> <span class="token function">createJdbcTemplate</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">initTemplateConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>下面为修改后的文件</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>	<span class="token comment">&lt;!-- 之前的配置
	&lt;bean id=&quot;myJdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;
		&lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot;/&gt;
	&lt;/bean&gt;
	
	&lt;bean id=&quot;studentDao&quot; class=&quot;com.hahg.dao.StudentDaoImpl&quot;&gt;
		&lt;property name=&quot;jdbcTemplate&quot; ref=&quot;myJdbcTemplate&quot;/&gt;
	&lt;/bean&gt;
	--&gt;</span>
	<span class="token comment">&lt;!-- 新的配置 --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>studentDao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.hahg.dao.StudentDaoImpl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_4-1-9-查询姓名"><a href="#_4-1-9-查询姓名" class="header-anchor">#</a> 4.1.9 查询姓名</h3> <p>接着完成 Dao 层里查询姓名功能。</p> <h4 id="_1-查询所有姓名"><a href="#_1-查询所有姓名" class="header-anchor">#</a> （1）查询所有姓名</h4> <p>因为该方法的返回值为列表 List，所以可以使用 Jdbc 模块的 queryForList 方法。</p> <p>该方法的需要两个参数，第一个参数为 Sql 语句，第二个参数为 List 里每个元素的类型。这里 name 为字符串，所以第二个参数为 String.class。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAllStudentsNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;select name from student&quot;</span><span class="token punctuation">;</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> studentsNames <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">queryForList</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> studentsNames<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_2-根据id查询姓名"><a href="#_2-根据id查询姓名" class="header-anchor">#</a> （2）根据id查询姓名</h4> <p>因为该方法返回的是一个变量，所以可以使用 Jdbc 模块的 queryForList 方法。</p> <p>前两个参数与上面一致，这里需要填写第三个参数，第三个参数为数量可变的变量，和上面 4.1.4 节增删改使用的方法一致。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">selectStudentNameById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;select name from student where id=?&quot;</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> studentName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> studentName<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_4-1-10-查询自定义类型"><a href="#_4-1-10-查询自定义类型" class="header-anchor">#</a> 4.1.10 查询自定义类型</h3> <p>这里还需要实现两个方法，如下述代码所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAllStudents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Student</span> <span class="token function">selectStudentById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这两个方法需要返回自定义类型 Student，但 Jdbc 模板对象会将查询结果的各个值如 id，name 等自动封装成 Student 吗？</p> <p>答案是不会的，所以这里使用的方法都需要 RowMapper 对象，下面为查询所有学生信息使用的方法详情。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>JdbcTemplate</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">RowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> rowMapper<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">DataAccessException</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_1-rowmapper对象的定义"><a href="#_1-rowmapper对象的定义" class="header-anchor">#</a> （1）RowMapper对象的定义</h4> <p>RowMappper 接口有一个满足我们需求的实现类，是 BeanPropertyRowMapper。</p> <p>**BeanPropertyRowMapper.java：**这里只需要传递自定义类型的类名即可。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">BeanPropertyRowMapper</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> mappedClass<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">initialize</span><span class="token punctuation">(</span>mappedClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>或者我们也可以自己实现 RowMapper接口。实现该接口需要实现 mapRow 方法，该方法有两个参数，我们只需要使用到第一个参数。</p> <ul><li>rs：当查询出总的结果集后，框架会自动遍历这个结果集，每一次遍历的一行数据，都会被存放到这个参数中，也就是说，这里的 rs 代表的是一行数据，而不是所有查询结果。</li> <li>返回值为自定义对象 Student ，要对其进行映射操作。</li></ul> <p><strong>StudentRowMapper.java：</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentRowMapper</span> <span class="token keyword">implements</span> <span class="token class-name">RowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Student</span> <span class="token function">mapRow</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs<span class="token punctuation">,</span> <span class="token keyword">int</span> rowNum<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
		<span class="token class-name">Student</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		student<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		student<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		student<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> student<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_2-参数的传递"><a href="#_2-参数的传递" class="header-anchor">#</a> （2）参数的传递</h4> <p>若使用实现类 BeanPropertyRowMapper，则需要传递自定义类型的类名来初始化其对象。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Student</span> <span class="token function">selectStudentById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">RowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> mapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeanPropertyRowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Student</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;select id,name,age from student where id=?&quot;</span><span class="token punctuation">;</span>
		<span class="token class-name">Student</span> student <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> mapper<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> student<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>若使用的是自己实现接口，则可以直接 new 出来使用。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAllStudents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;select id,name,age from student&quot;</span><span class="token punctuation">;</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> students <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">StudentRowMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> students<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_4-2-spring-的事务管理"><a href="#_4-2-spring-的事务管理" class="header-anchor">#</a> 4.2 Spring 的事务管理</h2> <p>事务原本是数据库中的概念，在 Dao 层。但一般情况下，需要将事务提升到业务层， 即 Service 层。这样做是为了能够使用事务的特性来管理具体的业务。 在 Spring 中通常可以通过以下三种方式来实现对事务的管理：</p> <ol><li><p>使用 Spring 的事务代理工厂管理事务</p></li> <li><p>使用 Spring 的事务注解管理事务</p></li> <li><p>使用 AspectJ 的 AOP 配置管理事务</p></li></ol> <h3 id="_4-2-1-spring-事务管理-api"><a href="#_4-2-1-spring-事务管理-api" class="header-anchor">#</a> 4.2.1 Spring 事务管理 API</h3> <p>Spring 的事务管理，主要用到两个事务相关的接口。</p> <h4 id="_1-事务管理器接口"><a href="#_1-事务管理器接口" class="header-anchor">#</a> （1）事务管理器接口</h4> <p>事务管理器是 PlatformTransactionManager 接口对象。其主要用于 <u>完成事务的提交</u>、<u>回滚</u>，及<u>获取事务的状态信息</u>。可以查看 SpringAPI 帮助文档，里面有相对应的方法，帮助文档在 Spring 框架解压目录下的 docs/javadoc-api/index.html 里。</p> <img src="https://raw.githubusercontent.com/hahg2000/SSMPic/main/%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8API.png" style="zoom:80%;"> <h5 id="a、常用的两个实现类"><a href="#a、常用的两个实现类" class="header-anchor">#</a> A、常用的两个实现类</h5> <p>PlatformTransactionManager 接口有两个常用的实现类：</p> <ul><li>DataSourceTransactionManager：使用 JDBC 或 iBatis 进行持久化数据时使用。</li> <li>HibernateTransactionManager：使用 Hibernate 进行持久化数据时使用。</li></ul> <h5 id="b、spring-的回滚方式"><a href="#b、spring-的回滚方式" class="header-anchor">#</a> B、Spring 的回滚方式</h5> <p>Spring 事务的默认回滚方式是：发生运行时异常时回滚，发生受查异常时提交。不过， 对于受查异常，程序员也可以手工设置其回滚方式。</p> <h5 id="c、回顾错误与异常"><a href="#c、回顾错误与异常" class="header-anchor">#</a> C、回顾错误与异常</h5> <img src="https://raw.githubusercontent.com/hahg2000/SSMPic/main/%E9%94%99%E8%AF%AF%E5%92%8C%E5%BC%82%E5%B8%B8%E7%9A%84%E5%88%86%E7%B1%BB.png" style="zoom:80%;"> <ol><li><p>Throwable 类是 Java 语言中所有错误或异常的超类。只有当对象是此类(或其子类之一) 的实例时，才能通过 Java 虚拟机或者 Java 的 throw 语句抛出。</p></li> <li><p>Error 是程序在运行过程中出现的无法处理的错误，比如 OutOfMemoryError、 ThreadDeath、NoSuchMethodError 等。当这些错误发生时，程序是无法处理（捕获或抛出） 的，JVM 一般会终止线程。</p></li> <li><p>程序在编译和运行时出现的另一类错误称之为异常，它是 JVM 通知程序员的一种方式。 通过这种方式，让程序员知道已经或可能出现错误，要求程序员对其进行处理。</p> <p>异常分为 <strong>运行时异常</strong> 与 <strong>受查异常</strong>。</p> <p>运行时异常，是 RuntimeException 类或其子类 ，即 <u>只有在运行时才出现的异常</u>。</p> <p>如， NullPointerException、ArrayIndexOutOfBoundsException、IllegalArgumentException 等均属于运行时异常。这些异常由 JVM 抛出， <u>在编译时不要求必须处理（捕获或抛出）</u> 。但只要代码编写足够仔细，程序足够健壮，运行时异常是可以避免的。注意：该异常较严重。</p> <p>受查异常，也叫编译时异常，即 <u>在代码编写时要求必须捕获或抛出的异常</u> ，若不处理， 则无法通过编译。</p> <p>如 SQLException，ClassNotFoundException，IOException 等都属于受查异常。 RuntimeException 及其子类以外的异常，均属于受查异常。</p> <p>当然，用户自定义的 Exception 的子类，即 <u>用户自定义的异常也属受查异常</u>。程序员在定义异常时，只要未明确声明定义的 为 RuntimeException 的子类，那么定义的就是受查异常。</p></li></ol> <h4 id="_2-事务定义接口"><a href="#_2-事务定义接口" class="header-anchor">#</a> （2）事务定义接口</h4> <p>事务定义接口 TransactionDefinition 中定义了事务描述相关的三类常量：事务隔离级别、 事务传播行为、事务默认超时时限，及对它们的操作。</p> <h5 id="a、事务隔离级别"><a href="#a、事务隔离级别" class="header-anchor">#</a> A、事务隔离级别</h5> <p>参考网站：<a href="https://www.cnblogs.com/zhangchaocoming/p/12309555.html" target="_blank" rel="noopener noreferrer">mysql事务中的隔离级别（博客园）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>事务隔离级别是事务与事务之间的距离程度。</p> <p>事务隔离级别有有四种：</p> <ul><li>未提交读（Read uncommitted）</li> <li>已提交读（Read commited）</li> <li>可重复读（Repeatable read）</li> <li>可串行化（Serializable）</li></ul> <table><thead><tr><th>隔离程度</th> <th>脏读</th> <th>不可重复读</th> <th>幻读</th></tr></thead> <tbody><tr><td>未提交读</td> <td><span style="color:#FF7F50;">可能</span></td> <td><span style="color:#FF7F50;">可能</span></td> <td><span style="color:#FF7F50;">可能</span></td></tr> <tr><td>已提交读</td> <td><span style="color:green;">不可能</span></td> <td><span style="color:#FF7F50;">可能</span></td> <td><span style="color:#FF7F50;">可能</span></td></tr> <tr><td>可重复读</td> <td><span style="color:green;">不可能</span></td> <td><span style="color:green;">不可能</span></td> <td><span style="color:#FF7F50;">可能</span></td></tr> <tr><td>可串行化</td> <td><span style="color:green;">不可能</span></td> <td><span style="color:green;">不可能</span></td> <td><span style="color:green;">不可能</span></td></tr></tbody></table> <hr> <p>假设一个表的数据如下图：</p> <p><img src="https://raw.githubusercontent.com/hahg2000/SSMPic/main/%E8%84%8F%E8%AF%BB%E5%8E%9F%E8%A1%A8.png" alt=""></p> <p>那什么是脏读、不可重复读和幻读呢？</p> <ul><li>脏读：当一个事务读取到另一个事务修改但未提交的数据时，就可能发生脏读。</li></ul> <img src="https://raw.githubusercontent.com/hahg2000/SSMPic/main/%E8%84%8F%E8%AF%BB%E7%A4%BA%E4%BE%8B.png" style="zoom:80%;"> <ul><li>不可重复读：当执行 Select 操作时没有获得读锁或者 Select 操作执行后马上释放了读锁；而另外一个事务对数据进行了更新，导致当前事务读到了不同的结果。</li></ul> <img src="https://raw.githubusercontent.com/hahg2000/SSMPic/main/%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E7%A4%BA%E4%BE%8B.png" style="zoom:80%;"> <ul><li>幻读：是不可重复读的一种特殊场景。</li></ul> <img src="https://raw.githubusercontent.com/hahg2000/SSMPic/main/%E5%B9%BB%E8%AF%BB%E7%A4%BA%E4%BE%8B.png" style="zoom:70%;"> <ul><li>脏读和不可重复读的区别：脏读指读到了其他事务未提交的数据；不可重复读指读到了其他事务已提交的数据</li> <li>不可重复读与幻读的区别：它们都是读到其他事务已提交的数据，但它们的针对点不同。不可重复读是 Update，幻读是 Delete 和 Insert。</li></ul> <hr> <p>接下来看看这四种隔离级别</p> <ol><li>未提交读：最低的隔离级别。当一个事务进行写数据时，另一个事务 <u>不允许写操作但可以进行读操作</u>。如上面脏读的示例图所示，事务 2 进行写操作时，事务 1 进行读操作，产生了脏读。所以 <strong>未提交读可能会产生脏读</strong>。</li> <li>已提交读：是上面未提交读的升级版，<u>当一个事务进行写数据时，另一个事务则禁止访问</u>，可以防止脏读。但由于依然没有加上读锁，所以不能防止不可重复读。</li> <li>可重复读：可以防止不可重复读。接下来会详细说明。</li> <li>可串行化：是高的隔离级别，它求在选定对象上的读锁和写锁 <u>保持直到事务结束后才能释放</u>，所以能防住上诉所有问题,但因为是串行化的所以效率较低。</li></ol> <hr> <p>上面所说的在对象上加锁，是一种悲观锁机制。</p> <ul><li>悲观锁：在整个数据处理过程中，将数据处于锁定状态。其依靠数据库的锁机制实现，<strong>以保证操作最大程度的独占性</strong>。但 <strong>需要消耗大量的数据库性能</strong>。</li> <li>乐观锁：基于数据版本记录机制实现。通过 <strong>为数据库增加一个版本 “ Version” 的字段</strong>。每次读数据时，都会将其与数据一起读出。</li> <li>MySQL、ORACLE、PostgreSQL等都是使用了以 <strong>乐观锁</strong> 为理论基础的MVCC（多版本并发控制）来避免不可重复读和幻读。</li> <li>在InnoDB（Mysql 默认数据库引擎）中 MVCC 的实现是在每行数据后添加两个额外的隐藏的值，一个是该数据在哪个版本号创建，另一个记录该行数据何时过期。
<ul><li>select 时，读取创建版本号 &lt;= 当前事务版本号（读之前的有效数据），删除版本号为空 或者 删除版本号 &gt;当前事务版本号（回滚操作）</li> <li>insert 时，保存当前事务版本号为行的创建版本号</li> <li>delete 时，保存当前事务版本号为行的删除版本号</li> <li>update 时，插入一条新纪录，保存当前事务版本号为行创建版本号，同时保存当前事务版本号到原来删除的行</li></ul></li></ul> <h5 id="b、事务传播行为"><a href="#b、事务传播行为" class="header-anchor">#</a> B、事务传播行为</h5> <p>所谓事务传播行为是指，处于不同事务中的方法在相互调用时，执行期间事务的维护情况。</p> <p>如，A 事务中的方法 doSome() 调用 B 事务中的方法 doOther()，在调用执行期间事务的维护情况，就称为事务传播行为，换句话来说就是 A 事务的方法调用 B 事务的方法，那么事务 B 的方法要在哪个事务的管理下运行？。</p> <p>事务传播行为是加在方法上的。 事务传播行为常量都是以 PROPAGATION_ 开头，形如 PROPAGATION_XXX。下面将举例七个传播行为。</p> <ol><li>REQUIRED：指定的方法必须在事务内执行。若当前存在事务，就加入到当前事务中； 若当前没有事务，则创建一个新事务。这种传播行为是最常见的选择，也是 Spring 默认的事务传播行为。
以回家吃饭为例，若回家有饭吃就直接吃，没饭吃就自己做来吃，这个是最常见的一种行为。</li></ol> <img src="https://raw.githubusercontent.com/hahg2000/SSMPic/main/%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA1.png" style="zoom:70%;"> <ol start="2"><li>SUPPORTS ：指定的方法支持当前事务，但若当前没有事务，也可以以非事务方式执行。
你现在不是很饿，回家后若还有饭就去吃，没有饭就不吃，毕竟不是很饿。</li></ol> <img src="https://raw.githubusercontent.com/hahg2000/SSMPic/main/%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA2.png" style="zoom:70%;"> <ol start="3"><li>MANDATORY：指定的方法必须在当前事务内执行，若当前没有事务，则直接抛出异常。
你现在十分饿，回家后必须吃饭，若没有饭吃则直接被饿得晕倒。</li></ol> <img src="https://raw.githubusercontent.com/hahg2000/SSMPic/main/%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA3.png" style="zoom:70%;"> <ol start="4"><li>REQUIRES_NEW：总是新建一个事务，若当前存在事务，就将当前事务挂起，直到新事务执行完毕。
你现在很有钱，就算你回家时看到还有饭时，也要煮新鲜的来吃。</li></ol> <img src="https://raw.githubusercontent.com/hahg2000/SSMPic/main/%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA4.png" style="zoom:70%;"> <ol start="5"><li>NOT_SUPPORTED：指定的方法不能在事务环境中执行，若当前存在事务，就将当前事务挂起。
你现在已经饱了，若已经有饭了，则就不吃；没有饭就更好。</li></ol> <img src="https://raw.githubusercontent.com/hahg2000/SSMPic/main/%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA5.png" style="zoom:70%;"> <ol start="6"><li>NEVER：指定的方法不能在事务环境下执行，若当前存在事务，就直接抛出异常。
你已经很撑了，若看到家里还有饭就直接晕倒。</li></ol> <img src="C:\Users\98375\AppData\Roaming\Typora\typora-user-images\image-20210417175901199.png" alt="image-20210417175901199" style="zoom:70%;"> <ol start="7"><li>NESTED：指定的方法必须在事务内执行。若当前存在事务，则在嵌套事务内执行；若当前没有事务，则创建一个新事务。
回家若没有饭，则自己做；若有饭，但有一道菜你很想吃，那就多做一盘菜，与旧菜一起吃完。</li></ol> <img src="https://raw.githubusercontent.com/hahg2000/SSMPic/main/%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA7.png" style="zoom:70%;"> <h5 id="c、定义了默认事务超时时限"><a href="#c、定义了默认事务超时时限" class="header-anchor">#</a> C、定义了默认事务超时时限</h5> <p>常量 TIMEOUT_DEFAULT 定义了事务底层默认的超时时限，及不支持事务超时时限设置 的 none 值。</p> <p>注意，事务的超时时限起作用的条件比较多，且超时的时间计算点较复杂。所以，该值 一般就使用默认值即可。</p> <h3 id="_4-2-2-程序举例环境搭建"><a href="#_4-2-2-程序举例环境搭建" class="header-anchor">#</a> 4.2.2 程序举例环境搭建</h3> <p>举例：购买股票—transaction_buystock 项目</p> <p>本例要实现模拟购买股票。存在两个实体：银行账户 Account 与股票账户 Stock。当要购买股票时，需要从 Account 中扣除相应金额的存款，然后在 Stock 中增加相应的股票数量。 而在这个过程中，可能会抛出一个用户自定义的异常。异常的抛出，将会使两个操作回滚。</p> <h4 id="_1-创建数据库表"><a href="#_1-创建数据库表" class="header-anchor">#</a> （1）创建数据库表</h4> <p>需要操作数据库的数据，当然第一步就要设计数据库的表项。</p> <p>account表：里面有三列，分别代表用户ID、用户姓名和用户财产。</p> <img src="https://raw.githubusercontent.com/hahg2000/SSMPic/main/%E8%82%A1%E7%A5%A8%E7%A4%BA%E4%BE%8B-account%E8%A1%A8.png" style="zoom:80%;"> <p>stock表：里面有三列，分别代表股票ID、股票名称和拥有数量。</p> <img src="https://raw.githubusercontent.com/hahg2000/SSMPic/main/%E8%82%A1%E7%A5%A8%E7%A4%BA%E4%BE%8B-stock%E8%A1%A8.png" style="zoom:80%;"> <h4 id="_2-创建实体类"><a href="#_2-创建实体类" class="header-anchor">#</a> （2）创建实体类</h4> <p>数据库的数据需要实体类进行包装才能成为对象，所以这一步需要创建实体类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> aid<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> aname<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">double</span> balance<span class="token punctuation">;</span>
	<span class="token comment">// setter and getter</span>
	<span class="token comment">// toString()</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Stock</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> sid<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> sname<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">double</span> count<span class="token punctuation">;</span>
    <span class="token comment">// setter and getter</span>
	<span class="token comment">// toString()</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_3-定义-service"><a href="#_3-定义-service" class="header-anchor">#</a> （3）定义 Service</h4> <p>这一步根据 需求来定义 Service 。</p> <p>从 4.2.2 前言可知有三个需求：开用户账户、开股票账户、购买股票。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IBuyStockService</span> <span class="token punctuation">{</span>
	<span class="token comment">// 开用户账户</span>
	<span class="token keyword">void</span> <span class="token function">openAccount</span><span class="token punctuation">(</span><span class="token class-name">String</span> aname<span class="token punctuation">,</span> <span class="token keyword">double</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 开股票账户</span>
	<span class="token keyword">void</span> <span class="token function">openStock</span><span class="token punctuation">(</span><span class="token class-name">String</span> sname<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 购买股票</span>
	<span class="token keyword">void</span> <span class="token function">buyStock</span><span class="token punctuation">(</span><span class="token class-name">String</span> aname<span class="token punctuation">,</span> <span class="token keyword">double</span> money<span class="token punctuation">,</span> <span class="token class-name">String</span> sname<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>然后在实现类实现上述接口。</p> <p>BuyStockServiceImpl.java：</p> <ul><li>Service 层需要调用 Dao 层的方法，所以定义 Dao 对象和它们的 setter 方法。</li> <li>两个开户操作直接调用 Dao 层的 <strong>插入数据</strong> 的方法。</li> <li>在购买方法里，定义了一个 isBuy 的变量，这里没有实际用途，只是满足需求表示而已。</li> <li>在购买方法里，购买股票的操作需要调用两个 <strong>更新数据</strong> 的方法。</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BuyStockServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IBuyStockService</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">IAccountDao</span> accountDao<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">IStockDao</span> stockDao<span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAccountDao</span><span class="token punctuation">(</span><span class="token class-name">IAccountDao</span> accountDao<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>accountDao <span class="token operator">=</span> accountDao<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStockDao</span><span class="token punctuation">(</span><span class="token class-name">IStockDao</span> stockDao<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>stockDao <span class="token operator">=</span> stockDao<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">openAccount</span><span class="token punctuation">(</span><span class="token class-name">String</span> aname<span class="token punctuation">,</span> <span class="token keyword">double</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		accountDao<span class="token punctuation">.</span><span class="token function">insertAccount</span><span class="token punctuation">(</span>aname<span class="token punctuation">,</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">openStock</span><span class="token punctuation">(</span><span class="token class-name">String</span> sname<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		stockDao<span class="token punctuation">.</span><span class="token function">insertStock</span><span class="token punctuation">(</span>sname<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buyStock</span><span class="token punctuation">(</span><span class="token class-name">String</span> aname<span class="token punctuation">,</span> <span class="token keyword">double</span> money<span class="token punctuation">,</span> <span class="token class-name">String</span> sname<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BuyStockException</span><span class="token punctuation">{</span>
		<span class="token keyword">boolean</span> isBuy <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		accountDao<span class="token punctuation">.</span><span class="token function">updateAccount</span><span class="token punctuation">(</span>aname<span class="token punctuation">,</span> money<span class="token punctuation">,</span> isBuy<span class="token punctuation">)</span><span class="token punctuation">;</span>
		stockDao<span class="token punctuation">.</span><span class="token function">updateStock</span><span class="token punctuation">(</span>sname<span class="token punctuation">,</span> amount<span class="token punctuation">,</span> isBuy<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h4 id="_4-定义-dao"><a href="#_4-定义-dao" class="header-anchor">#</a> （4）定义 Dao</h4> <p>这步根据上面的要求将实现两个插入操作和两个更新操作。</p> <p>下面为 StockDao 的接口和实现类。</p> <p>更新操作的方法：如果是买的话，股票数量则增加；否则减少。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IStockDao</span> <span class="token punctuation">{</span>

	<span class="token keyword">void</span> <span class="token function">insertStock</span><span class="token punctuation">(</span><span class="token class-name">String</span> sname<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">void</span> <span class="token function">updateStock</span><span class="token punctuation">(</span><span class="token class-name">String</span> sname<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isBuy<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StockDaoImpl</span> <span class="token keyword">extends</span> <span class="token class-name">JdbcDaoSupport</span> <span class="token keyword">implements</span> <span class="token class-name">IStockDao</span><span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertStock</span><span class="token punctuation">(</span><span class="token class-name">String</span> sname<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;insert into stock(sname,amount) values (?,?)&quot;</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateStock</span><span class="token punctuation">(</span><span class="token class-name">String</span> sname<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isBuy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;update stock set amount=amount-? where sname=?&quot;</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>isBuy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			sql <span class="token operator">=</span> <span class="token string">&quot;update stock set amount=amount+? where sname=?&quot;</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> amount<span class="token punctuation">,</span> sname<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>下面为 AccountDao 的接口和实现类。</p> <p>更新操作的方法：如果是买的话，用户财产则减少；否则增加。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IAccountDao</span> <span class="token punctuation">{</span>

	<span class="token keyword">void</span> <span class="token function">insertAccount</span><span class="token punctuation">(</span><span class="token class-name">String</span> aname<span class="token punctuation">,</span> <span class="token keyword">double</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">void</span> <span class="token function">updateAccount</span><span class="token punctuation">(</span><span class="token class-name">String</span> aname<span class="token punctuation">,</span> <span class="token keyword">double</span> money<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isBuy<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountDaoImpl</span> <span class="token keyword">extends</span> <span class="token class-name">JdbcDaoSupport</span> <span class="token keyword">implements</span> <span class="token class-name">IAccountDao</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertAccount</span><span class="token punctuation">(</span><span class="token class-name">String</span> aname<span class="token punctuation">,</span> <span class="token keyword">double</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;insert into account(aname,balance) values (?,?)&quot;</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> aname<span class="token punctuation">,</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateAccount</span><span class="token punctuation">(</span><span class="token class-name">String</span> aname<span class="token punctuation">,</span> <span class="token keyword">double</span> money<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isBuy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;update account set balance=balance+? where aname=?&quot;</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>isBuy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			sql <span class="token operator">=</span> <span class="token string">&quot;update account set balance=balance-? where aname=?&quot;</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> money<span class="token punctuation">,</span> aname<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="_5-定义测试类"><a href="#_5-定义测试类" class="header-anchor">#</a> （5）定义测试类</h4> <p>这步定义测试类，测试类依旧如之前一样：</p> <ul><li>获取 Spring 容器，再根据容器获取 Service 对象。</li> <li>使用 Service  对象调用相对应的方法
<ul><li>这里先调用两个开户方法；</li> <li>再调用购买股票方法。</li></ul></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTest</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">IBuyStockService</span> stockService<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Before</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myBefore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;applicationContext.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
		 stockService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">IBuyStockService</span><span class="token punctuation">)</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;stockService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		stockService<span class="token punctuation">.</span><span class="token function">openAccount</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		stockService<span class="token punctuation">.</span><span class="token function">openStock</span><span class="token punctuation">(</span><span class="token string">&quot;腾讯公司&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>	
		stockService<span class="token punctuation">.</span><span class="token function">buyStock</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token string">&quot;腾讯公司&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="_6-定义xml文件"><a href="#_6-定义xml文件" class="header-anchor">#</a> （6）定义Xml文件</h4> <p>这步将完成 Xml 文件的配置。</p> <p>先完成 IOC 的配置，先创建数据源，再使用数据源创建 Dao 层的 Bean，最后根据 Dao 层的 Bean 创建 Service 层的 Bean。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- ==============================IOC================================= --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span>
		<span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>classpath:jdbc.properties<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myDataSource<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.datasource.DriverManagerDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driverClassName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.driver}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.url}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.user}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.password}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>accountDao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.hahg.dao.AccountDaoImpl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myDataSource<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stockDao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.hahg.dao.StockDaoImpl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myDataSource<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stockService<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.hahg.service.BuyStockServiceImpl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>accountDao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>accountDao<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stockDao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stockDao<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="_7-定义异常类"><a href="#_7-定义异常类" class="header-anchor">#</a> （7）定义异常类</h4> <p>这一步将定义购买股票异常类，创建自定义异常类需要继承 Exception 类。</p> <p><strong>BuyStockException.java：</strong> 在类里创建一个无参构造方法和一个一参数构造方法。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BuyStockException</span> <span class="token keyword">extends</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token class-name">BuyStockException</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// TODO Auto-generated constructor stub</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">BuyStockException</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// TODO Auto-generated constructor stub</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_8-添加异常到-service"><a href="#_8-添加异常到-service" class="header-anchor">#</a> （8）添加异常到 Service</h4> <p>在两条购买语句中间抛出购买股票异常，注意这里加上了永真的判断条件，因为不加上这个条件，编译不通过。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IBuyStockService</span> <span class="token punctuation">{</span>
	
	<span class="token keyword">void</span> <span class="token function">openAccount</span><span class="token punctuation">(</span><span class="token class-name">String</span> aname<span class="token punctuation">,</span> <span class="token keyword">double</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">openStock</span><span class="token punctuation">(</span><span class="token class-name">String</span> sname<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">void</span> <span class="token function">buyStock</span><span class="token punctuation">(</span><span class="token class-name">String</span> aname<span class="token punctuation">,</span> <span class="token keyword">double</span> money<span class="token punctuation">,</span> <span class="token class-name">String</span> sname<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BuyStockException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buyStock</span><span class="token punctuation">(</span><span class="token class-name">String</span> aname<span class="token punctuation">,</span> <span class="token keyword">double</span> money<span class="token punctuation">,</span> <span class="token class-name">String</span> sname<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BuyStockException</span><span class="token punctuation">{</span>
		<span class="token keyword">boolean</span> isBuy <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		accountDao<span class="token punctuation">.</span><span class="token function">updateAccount</span><span class="token punctuation">(</span>aname<span class="token punctuation">,</span> money<span class="token punctuation">,</span> isBuy<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BuyStockException</span><span class="token punctuation">(</span><span class="token string">&quot;购买股票异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		stockDao<span class="token punctuation">.</span><span class="token function">updateStock</span><span class="token punctuation">(</span>sname<span class="token punctuation">,</span> amount<span class="token punctuation">,</span> isBuy<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_9-修改测试类"><a href="#_9-修改测试类" class="header-anchor">#</a> （9）修改测试类</h4> <p>在第二个测试方法中加上 try-catch 块</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			stockServiceProxy<span class="token punctuation">.</span><span class="token function">buyStock</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token string">&quot;腾讯公司&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BuyStockException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// TODO Auto-generated catch block</span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-2-3-使用-spring-的事务代理工厂管理事务"><a href="#_4-2-3-使用-spring-的事务代理工厂管理事务" class="header-anchor">#</a> 4.2.3 使用 Spring 的事务代理工厂管理事务</h3> <p>在上面搭建环境完成后，运行代码会发现用户的钱会少，但已购买股票的数量却不增加。</p> <p>所以有必要在 Service 层加上事务管理，来保证运行的原子性。</p> <p>这小节介绍的是使用 Spring 的事务代理工厂管理事务。</p> <p>该方式是需要为目标类，即 Service 的实现类创建事务代理。</p> <p>事务代理使用的类是 TransactionProxyFactoryBean。该类需要初始化如下一些属性：</p> <ol><li>transactionManager：事务管理器</li> <li>target：目标对象，即 Service 实现类对象</li> <li>transactionAttributes：事务属性设置</li></ol> <p>对于 XML 配置代理方式实现事务管理时，<span style="color:red;">受查异常</span> 的回滚方式，程序员可以通过以下方式进行设置：</p> <ul><li><p>通过 “ -异常 ” 方式，可使发生指定的异常（受查异常）时事务回滚；</p></li> <li><p>通过“ +异常 ”方式， 可使发生指定的异常（运行异常）时事务提交。</p></li></ul> <p>该方式的实现步骤为：</p> <h4 id="_1-导入jar包"><a href="#_1-导入jar包" class="header-anchor">#</a> （1）导入Jar包</h4> <p>需要导入 Aop 联盟 Jar 包【aopalliance-1.0.jar】和 Spring 对 Aop 实现的 Jar 包 【spring-aop-4.3.6.RELEASE.jar】</p> <h4 id="_2-在容器中添加事务管理器"><a href="#_2-在容器中添加事务管理器" class="header-anchor">#</a> （2）在容器中添加事务管理器</h4> <p>本例使用的是 JDBC 进行持久化，所以使用 DataSourceTransactionManager 作为事务管理器。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- ==============================AOP================================= --&gt;</span>

	<span class="token comment">&lt;!-- 注册事务管理器 --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myTransactionManager<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myDataSource<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_3-在容器中添加事务代理"><a href="#_3-在容器中添加事务代理" class="header-anchor">#</a> （3）在容器中添加事务代理</h4> <p>配置 Service 的事务代理的三个属性：</p> <ul><li>transactionManager：使用上面注册的事务管理器；</li> <li>target：代理的目标类，stockService；</li> <li>transactionAttributes：可单独指定每个方法的事务设置；这里需要指定 自定义异常 BuyStockException 进行回滚操作。</li></ul> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>serviceProxy<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.transaction.interceptor.TransactionProxyFactoryBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span>
			<span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myTransactionManager<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>target<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stockService<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionAttributes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>props</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>open*<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ISOLATION_DEFAULT,PROPAGATION_REQUIRED<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>find*<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ISOLATION_DEFAULT,PROPAGATION_REQUIRED<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>buyStock<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ISOLATION_DEFAULT,PROPAGATION_REQUIRED, -BuyStockException<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>props</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_4-修改测试类"><a href="#_4-修改测试类" class="header-anchor">#</a> （4）修改测试类</h4> <p>在测试类中，修改获取 Bean 的名字，需要获取代理对象。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Before</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myBefore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;applicationContext.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		stockServiceProxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">IBuyStockService</span><span class="token punctuation">)</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;serviceProxy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_4-2-4-事务注解管理事务"><a href="#_4-2-4-事务注解管理事务" class="header-anchor">#</a> 4.2.4 事务注解管理事务</h3> <p>通过@Transactional 注解方式，也可将事务织入到相应方法中。而使用注解方式，只需 在配置文件中加入一个 tx 标签，以告诉 spring 使用注解来完成事务的织入。</p> <p>该标签只需指定一个属性，事务管理器。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 开启事务注解驱动 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>annotation-driven</span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>@Transactional 的所有可选属性如下所示：</p> <ul><li>propagation：<u>用于设置事务传播属性</u>。该属性类型为 Propagation 枚举，默认值为 Propagation.REQUIRED。</li> <li>isolation：<u>用于设置事务的隔离级别</u>。该属性类型为 Isolation 枚举，默认值为 Isolation.DEFAULT。</li> <li>readOnly：<u>用于设置该方法对数据库的操作是否是只读的</u>。该属性为 boolean，默认值 为 false。</li> <li>timeout：<u>用于设置本操作与数据库连接的超时时限</u>。单位为秒，类型为 int，默认值为 -1，即没有时限。</li> <li>rollbackFor：<u>指定需要回滚的异常类</u>。类型为 Class[]，默认值为空数组。当然，若只有 一个异常类时，可以不使用数组。</li> <li>rollbackForClassName：<u>指定需要回滚的异常类类名</u>。类型为 String[]，默认值为空数组。 当然，若只有一个异常类时，可以不使用数组。</li> <li>noRollbackFor：<u>指定不需要回滚的异常类</u>。类型为 Class[]，默认值为空数组。当然，若 只有一个异常类时，可以不使用数组。</li> <li>noRollbackForClassName：<u>指定不需要回滚的异常类类名</u>。类型为 String[]，默认值为空 数组。当然，若只有一个异常类时，可以不使用数组。</li></ul> <p>需要注意的是，@Transactional 若用在方法上，<strong>只能用于 public 方法上</strong>。对于其他非 public 方法，如果加上了注解@Transactional，虽然 Spring 不会报错，但不会将指定事务织入到该方法中。因为 Spring 会忽略掉所有非 public 方法上的@Transaction 注解。</p> <p>若@Transaction 注解在类上，则表示该类上所有的方法均将在执行时织入事务。</p> <hr> <p>下面就是为 BuyStockException 方法进行注解：</p> <ul><li>使用了 propagation 来设置事务传播属性；</li> <li>使用了 isolation 来设置事务的隔离级别；</li> <li>使用了 rollbackFor 来设置需要回滚的异常类类名。</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// &lt;prop key=&quot;buyStock&quot;&gt;ISOLATION_DEFAULT,PROPAGATION_REQUIRED, -BuyStockException&lt;/prop&gt;</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span>REQUIRED<span class="token punctuation">,</span> isolation <span class="token operator">=</span> <span class="token class-name">Isolation</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">BuyStockException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buyStock</span><span class="token punctuation">(</span><span class="token class-name">String</span> aname<span class="token punctuation">,</span> <span class="token keyword">double</span> money<span class="token punctuation">,</span> <span class="token class-name">String</span> sname<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BuyStockException</span><span class="token punctuation">{</span>
		<span class="token keyword">boolean</span> isBuy <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		accountDao<span class="token punctuation">.</span><span class="token function">updateAccount</span><span class="token punctuation">(</span>aname<span class="token punctuation">,</span> money<span class="token punctuation">,</span> isBuy<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BuyStockException</span><span class="token punctuation">(</span><span class="token string">&quot;购买股票异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		stockDao<span class="token punctuation">.</span><span class="token function">updateStock</span><span class="token punctuation">(</span>sname<span class="token punctuation">,</span> amount<span class="token punctuation">,</span> isBuy<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_4-2-5-使用-aspectj-的-aop-配置管理事务-重点"><a href="#_4-2-5-使用-aspectj-的-aop-配置管理事务-重点" class="header-anchor">#</a> 4.2.5 使用 AspectJ 的 AOP 配置管理事务（重点）</h3> <p>使用 XML 配置事务代理的方式的不足是，每个目标类都需要配置事务代理。</p> <p>当目标类较多，配置文件会变得非常臃肿。 使用 XML 配置顾问方式可以自动为每个符合切入点表达式的类生成事务代理。</p> <p>其用法很简单，只需将前面代码中关于事务代理的配置删除，再替换为如下内容即可。</p> <h4 id="_1-导入-jar-包"><a href="#_1-导入-jar-包" class="header-anchor">#</a> （1）导入 Jar 包</h4> <p>在 4.2.4 的基础上继续导入 AspectJ 所使用的 Jar 包：【aspectjweaver-1.8.10.jar】以及 【spring-aspects-4.3.6.RELEASE.jar】</p> <h4 id="_2-注册事务管理器"><a href="#_2-注册事务管理器" class="header-anchor">#</a> （2）注册事务管理器</h4> <p>与上面的一致</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 注册事务管理器 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myTransactionManager<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myDataSource<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_3-配置事务通知"><a href="#_3-配置事务通知" class="header-anchor">#</a> （3）配置事务通知</h4> <p>这里使用到的是 tx 事务包里的事务通知。</p> <ul><li>创建其需要指定其 transaction-manager 属性，属性值为第（2）点所注册的事务管理器；</li> <li>在 &lt;tx:attributes/&gt; 标签里可以使用 &lt;tx:method/&gt; 来为每一个 <span style="color:red;">连接点</span> 所要应用的事务属性；</li> <li>在 &lt;tx:method/&gt; 中可以使用 isolation、propagation 属性来指定隔离级别和传播行为；rollback-for 属性指定需要回滚的异常。</li></ul> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>advice</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txAdvice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- 这里指定的是：为每一个连接点所要应用的事务属性 --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>open*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">isolation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEFAULT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">propagation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>REQUIRED<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>buyStock<span class="token punctuation">&quot;</span></span> <span class="token attr-name">isolation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEFAULT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">propagation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>REQUIRED<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rollback-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BuyStockException<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>advice</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_4-配置顾问"><a href="#_4-配置顾问" class="header-anchor">#</a> （4）配置顾问</h4> <p>使用顾问为上述通知进行包装，使其可以指定 <span style="color:red;">织入点</span>。这里指定的切入点为 service 包里的所有方法。</p> <p>注意这里指定的是织入点，而第（3）点配置的是每一个连接点，也就是说第（3）点的配置不一定起作用，最终起作用的是这里所指定的。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 这里指定的是切入点 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>pointcut</span> <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>execution(* *..service.*.*(..))<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myPointCut<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>	
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>advisor</span> <span class="token attr-name">advice-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txAdvice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myPointCut<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2021年5月15日星期六下午3点15分</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/doStudy/SSM框架/Spring4/六、Spring与Web.html" class="prev">
        六、Spring与Web
      </a></span> <!----></p></div>  <!----></main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/docs/assets/js/app.4e37dad2.js" defer></script><script src="/docs/assets/js/3.055be0a8.js" defer></script><script src="/docs/assets/js/2.d32c4d1a.js" defer></script><script src="/docs/assets/js/28.70255cc2.js" defer></script><script src="/docs/assets/js/4.a96d5034.js" defer></script>
  </body>
</html>
